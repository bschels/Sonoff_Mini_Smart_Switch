blueprint:
  name: âš¡ Sonoff Smart Switch - MiniR4M, MiniR4, ZBMINIR2 & More
  description: |
    ğŸ”Œ **Turn your traditional switch into a smart switch!**
    
    This blueprint allows a **Sonoff MiniR4M, MiniR4, ZBMINIR2, and other Sonoff devices** to control various types of devices with intelligent automation:
    - ğŸ’¡ **Smart Lamp** (Relay detachment recommended)
    - ğŸ’¡ **Dumb Lamp** (Relay toggles power)
    - ğŸŒ¬ **Bathroom Fan** (Manual & humidity-based automation)
    - ğŸ”¥ **Heater**
    - ğŸ’¨ **Humidifier**
    - âš™ï¸ **Other Smart or Non-Smart Devices**
    
    **Supported Sonoff Devices & Setup Requirements:**
    - ğŸŸ¢ **Sonoff MiniR4M** â†’ Relay detachment **enabled by default**. 
      - âš ï¸ **Setup:** If controlling a **smart lamp**, go to **Relay Settings** in the eWeLink app and enable **Detach Relay Mode**.
    - ğŸ”µ **Sonoff MiniR4** â†’ Similar to MiniR4M, supports switch automation.
      - âš ï¸ **Setup:** Enable **Detach Relay Mode** if using with a smart lamp.
    - ğŸŸ  **Sonoff ZBMINIR2** â†’ Zigbee model with local control.
      - âš ï¸ **Setup:** No relay detachment needed, but ensure it's paired with Home Assistant via Zigbee.
    - ğŸ”´ **Sonoff TX Series** â†’ Wall touch switch with multiple buttons.
      - âš ï¸ **Setup:** Use **Scene Mode** in eWeLink for multiple touch actions.
    - âšª **Sonoff BasicR3** â†’ Simple Wi-Fi relay switch for general automation.
      - âš ï¸ **Setup:** Default relay mode, no detachment needed.
    - âš« **Sonoff S26** â†’ Smart plug with remote control.
      - âš ï¸ **Setup:** No relay detachment required, just connect via LAN mode.
    - âš™ï¸ **Other Sonoff Models** â†’ Default settings will be applied.
    
    **Device Selection**
    - ğŸ  **Choose what you are controlling:** Select a mode (Smart Lamp, Dumb Lamp, Bathroom Fan, Generic Smart Device, Generic Non-Smart Device), and only relevant options will appear.
    
    **Bathroom Fan Mode:**
    - ğŸ–² **Manual Mode** â†’ Press the switch to run the fan for a set time (odor control).
    - ğŸŒ« **Automatic Mode** â†’ The fan turns on when humidity exceeds a threshold.
    - ğŸš¿ **Shower Detection** â†’ Detects rapid humidity increases and starts the fan.
    - ğŸ”„ **Hybrid Mode** â†’ The fan runs manually when pressed and also activates via humidity detection.
    - â³ **Custom Fan Runtime** â†’ Set a timer for how long the fan runs after activation.
    - ğŸ“‰ **Auto Off by Humidity** â†’ Optionally turn off the fan when humidity drops below a defined threshold.
    
    **Supported Switch Types & Behavior:**
    - ğŸš **Rocker Switch**: Stays in either "on" or "off" position. Best for simple toggling but doesn't support double or long press.
    - ğŸ”˜ **Push Button**: A momentary switch that springs back. Fully supports **single, double, and long press** actions.
    
    **Enhanced Features:**
    - ğŸ”„ **Relay Detachment (Optional)** â†’ Use the switch independently or toggle the relay.
    - ğŸ­ **Multi-Click Actions** â†’ Customize actions for single, double, and long press.
    - ğŸ¬ **Scene Activation** â†’ Trigger Home Assistant scenes (e.g., "Movie Night").
    - ğŸŒ **Adaptive Lighting** â†’ Auto-adjust brightness & color temperature by time of day.
    - âš¡ **Energy Monitoring** â†’ Get notifications if power usage is too high.
    - ğŸ“Š **Usage Tracking** â†’ Logs switch toggles for analysis in HA dashboards.
    - ğŸ”” **Notifications** â†’ Alerts when a device is turned on/off or power exceeds threshold.
    - ğŸ”„ **Control Multiple Devices** â†’ Toggle multiple devices at once.
    - ğŸ”’ **Safety Lock** â†’ Disable switch input when the switch is no longer needed.
  
  domain: automation
  input:
    sonoff_model:
      name: ğŸ· Sonoff Model
      description: "Select your Sonoff device. This will adjust settings automatically and provide setup instructions."
      selector:
        select:
          options:
            - "Sonoff MiniR4M"
            - "Sonoff MiniR4"
            - "Sonoff ZBMINIR2"
            - "Sonoff BasicR3"
            - "Sonoff TX Series"
            - "Sonoff S26"
            - "Other"
          mode: dropdown
      default: "Sonoff MiniR4M"
    enable_safety_lock:
      name: ğŸ”’ Disable Switch Input
      description: "Disable the physical switch input when it is no longer needed."
      default: false
      selector:
        boolean:
    auto_off_timer:
      name: â³ Auto-Off Timer (Optional)
      description: "Set a timeout to automatically turn off the controlled device."
      default: 0
      selector:
        number:
          min: 0
          max: 3600
          unit_of_measurement: seconds
    switch_type:
      name: ğŸš Switch Type
      description: "Select your switch type: Rocker (fixed on/off position) or Push Button (momentary press, supports multi-click actions)."
      selector:
        select:
          options:
            - "Rocker"
            - "Push Button"
          mode: dropdown
    controlled_device:
      name: ğŸ› Device to Control (Optional)
      description: "Select the device to control."
      default: {}
      selector:
        target:
          entity:
            domain: [switch, fan, climate, light]
    enable_adaptive_lighting:
      name: ğŸŒ Adaptive Lighting Mode
      description: "Enable automatic brightness and color temperature adjustments based on time of day."
      default: false
      selector:
        boolean:
            adaptive_lighting_mode:
      name: ğŸŒ… Adaptive Lighting Mode
      description: "Choose between Auto mode (recommended brightness and color temperature by time of day) or Advanced mode (custom settings)."
      selector:
        select:
          options:
            - "Off"
            - "Auto Mode"
            - "Advanced Mode"
          mode: dropdown
      default: "Off"
    brightness_morning:
      name: â˜€ï¸ Morning Brightness
      description: "Set brightness for morning hours (6AM - 12PM)."
      default: 80
      selector:
        number:
          min: 1
          max: 100
          unit_of_measurement: "%"
    brightness_evening:
      name: ğŸŒ™ Evening Brightness
      description: "Set brightness for evening hours (6PM - 12AM)."
      default: 60
      selector:
        number:
          min: 1
          max: 100
          unit_of_measurement: "%"
    color_temp_morning:
      name: â˜€ï¸ Morning Color Temperature
      description: "Set color temperature for morning hours."
      default: 4000
      selector:
        number:
          min: 2000
          max: 6500
          unit_of_measurement: "K"
    color_temp_evening:
      name: ğŸŒ™ Evening Color Temperature
      description: "Set color temperature for evening hours."
      default: 2700
      selector:
        number:
          min: 2000
          max: 6500
          unit_of_measurement: "K"
    humidity_sensor:
      name: ğŸŒ« Humidity Sensor
      description: "Select a humidity sensor to automate the bathroom fan."
      default: {}
      selector:
        entity:
          domain: sensor
    humidity_threshold:
      name: ğŸ“ˆ Humidity Threshold
      description: "Set the humidity level at which the fan should turn on automatically."
      default: 70
      selector:
        number:
          min: 40
          max: 100
          unit_of_measurement: "%"
    humidity_off_threshold:
      name: ğŸ“‰ Auto Off Humidity Threshold
      description: "Set the humidity level at which the fan should turn off automatically (optional)."
      default: 50
      selector:
        number:
          min: 30
          max: 70
          unit_of_measurement: "%"
    fan_runtime:
      name: â³ Fan Runtime
      description: "Set how long the fan should run after activation."
      default: 15
      selector:
        number:
          min: 1
          max: 60
          unit_of_measurement: minutes
    shower_detection:
      name: ğŸš¿ Shower Detection
      description: "Enable automatic fan activation when a rapid humidity increase is detected."
      default: false
      selector:
        boolean:

mode: restart
max_exceeded: silent
